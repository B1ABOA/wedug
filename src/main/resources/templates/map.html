<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>내 위치 카카오맵</title>
    <script th:inline="javascript">

        var apiKey = [[${apiKey}]];
    </script>
</head>
<body>
<!-- 지도를 표시할 div 요소 -->
<div id="map" style="width:500px;height:400px;"></div>
<script>
    // 카카오맵  로드하는 함수
    function loadKakaoMaps(callback) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'http://dapi.kakao.com/v2/maps/sdk.js?appkey=' + apiKey + '&autoload=false';
        script.onload = callback;
        document.head.appendChild(script);
    }

    // 지도를 초기화하고 사용자의 위치를 표시하는 함수
    function initMap() {
        kakao.maps.load(function() {
            // 지도를 표시할 div와 옵션 설정
            var mapContainer = document.getElementById('map');
            var mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 기본 중심 좌표
                level: 3 // 지도의 확대 레벨
            };

            // 지도 객체 생성
            var map = new kakao.maps.Map(mapContainer, mapOption);

            // 브라우저의 geolocation 지원 여부 확인
            if (navigator.geolocation) {
                // 사용자의 현재 위치 정보 요청
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude; // 위도
                    var lon = position.coords.longitude; // 경도
                    var locPosition = new kakao.maps.LatLng(lat, lon);

                    // 지도 중심을 사용자의 위치로 이동
                    map.setCenter(locPosition);

                    // 사용자 위치에 마커 생성
                    var marker = new kakao.maps.Marker({
                        position: locPosition
                    });
                    marker.setMap(map);

                }, function(error) {
                    // 위치 정보를 가져오는데 실패한 경우 에러 로그 출력
                    console.log('Geolocation failed: ' + error.message);
                }, {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    timeout: 5000
                });
            } else {
                // geolocation을 지원하지 않는 경우 로그 출력
                console.log('Geolocation is not supported by this browser.');
            }
        });
    }

    // 지도 초기화 함수 호출
    loadKakaoMaps(initMap);
</script>
</body>
</html>